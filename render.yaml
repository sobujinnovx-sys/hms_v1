services:
  - type: web
    name: healthcare-backend
    env: python
    plan: free
    buildCommand: "cd backend && pip install -r requirements.txt"
    startCommand: "cd backend && gunicorn app.main:app --workers 2 --worker-class uvicorn.workers.UvicornWorker --bind 0.0.0.0:$PORT"
    envVars:
      - key: PYTHON_VERSION
        value: 3.11
      - key: DATABASE_URL
        value: mysql+pymysql://root:@localhost:3306/healthcare_db
      - key: JWT_SECRET_KEY
        fromService:
          name: healthcare-secrets
          property: JWT_SECRET_KEY
      - key: DEBUG
        value: "False"

  - type: static_site
    name: healthcare-frontend
    buildCommand: "cd frontend && npm install && npm run build"
    staticPublishPath: frontend/dist
    envVars:
      - key: VITE_API_URL
        value: https://healthcare-backend.onrender.com

  - type: pserv
    name: healthcare-db
    env: mysql
    plan: free
    ipAllowList:
      - source: 0.0.0.0/0
        description: Allow all
